<!doctype html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>JsSpim</title>
</head>

<body>
<pre id="output" style="width: 100%; height: 100%;"></pre>
<script type='text/javascript'>
    const output = document.getElementById('output');
    var Module = {
        preRun: [],
        postRun: [main],
        print,
        printErr,
        totalDependencies: 0,
        monitorRunDependencies: function (left) {
            this.totalDependencies = Math.max(this.totalDependencies, left);
        },
    };

    function main() {
        const get_user_text = cwrap('get_user_text', 'string');
        const get_kernel_text = cwrap('get_kernel_text', 'string');
        const get_user_stack = cwrap('get_user_stack', 'string');
        const get_all_regs = cwrap('get_all_regs', 'string');
        const get_reg = cwrap('get_reg', 'number', ['number']);
        const init = cwrap('init', 'void', ['string']);
        const run = cwrap('run', 'void');
        const step = cwrap('step', 'void');
        init('Tests/read.s');
        run();
        console.log(get_all_regs());
    }

    function print(text) {
        console.log(text);
        output.innerHTML += text + "\n";
        output.scrollTop = output.scrollHeight; // focus on bottom
    }

    function printErr(text) {
        console.error(text);
    }
</script>
<script async type="text/javascript" src="spim.js"></script>
</body>
</html>