<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>JsSpim</title>
</head>
<body>

<div id="toolbar">
    <button id="run">run</button>
    <button id="step">step</button>
</div>

<div id="main">
    <div id="regs-container">
        <h1>Register</h1>
        <pre id="regs-content" class="content"></pre>
    </div>
    <div id="memory-container">
        <h1>Memory</h1>
        <pre id="memory-content" class="content"></pre>
    </div>
</div>

<div id="info">
    <div id="output-container">
        <h1>Output</h1>
        <pre id="output-content" class="content"></pre>
    </div>
    <div id="log-container">
        <h1>Log</h1>
        <pre id="log-content" class="content"></pre>
    </div>
</div>


<script type='text/javascript'>
    const outputDOM = document.getElementById('output-content');
    const regsDOM = document.getElementById('regs-content');
    const memoryDOM = document.getElementById('memory-content');
    const stepDOM = document.getElementById('step');
    const runDOM = document.getElementById('run');

    var Module = {
        preRun: [],
        postRun: [main],
        print,
        printErr,
        totalDependencies: 0,
        monitorRunDependencies: function (left) {
            this.totalDependencies = Math.max(this.totalDependencies, left);
        },
    };

    function main() {
        const get_user_text = cwrap('get_user_text', 'string');
        const get_kernel_text = cwrap('get_kernel_text', 'string');
        const get_user_stack = cwrap('get_user_stack', 'string');
        const get_all_regs = cwrap('get_all_regs', 'string');
        const get_reg = cwrap('get_reg', 'number', ['number']);
        const init = cwrap('init', 'void', ['string']);
        const run = cwrap('run', 'void');
        const step = cwrap('step', 'void');
        init('Tests/fib.s');
        runDOM.onclick = () => run();
        stepDOM.onclick = () => step();
        regsDOM.innerText = get_all_regs();
        memoryDOM.innerText = get_user_text();
    }

    function print(text) {
        console.log(text);
        outputDOM.innerHTML += text + "\n";
        outputDOM.scrollTop = outputDOM.scrollHeight; // focus on bottom
    }

    function printErr(text) {
        console.error(text);
    }
</script>
<script async type="text/javascript" src="wasm.js"></script>
</body>
</html>